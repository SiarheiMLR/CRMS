<UserControl x:Class="CRMS.Views.Support.TicketStatsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes" 
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"              
             xmlns:converters="clr-namespace:CRMS.Infrastructure.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="Transparent">

    <UserControl.Resources>
        <converters:StatusToRussianConverter x:Key="StatusToRussianConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
        <converters:PriorityToRussianConverter x:Key="PriorityToRussianConverter"/>
        <converters:PriorityToColorConverter x:Key="PriorityToColorConverter"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">

            <!-- Заголовок и выбор периода -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                <TextBlock Text="Статистика заявок"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center"/>

                <StackPanel Orientation="Horizontal" Margin="20,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Год: "
                               Foreground="White"
                               Margin="0,0,5,0"
                               VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding AvailableYears}"
                              SelectedItem="{Binding SelectedYear, Mode=TwoWay}"
                              Width="80"
                              Margin="0,0,15,0"
                              Foreground="White"
                              FontWeight="SemiBold"
                              HorizontalContentAlignment="Center"
                              VerticalContentAlignment="Center"/>

                    <TextBlock Text="Тип периода: "
                               Foreground="White"
                               Margin="0,0,5,0"
                               VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding PeriodTypes}"
                              SelectedItem="{Binding SelectedPeriodType, Mode=TwoWay}"
                              Width="100"
                              Margin="0,0,15,0"
                              Foreground="White"
                              FontWeight="SemiBold"
                              HorizontalContentAlignment="Center"
                              VerticalContentAlignment="Center"/>

                    <TextBlock Text="Период: "
                               Foreground="White"
                               Margin="0,0,5,0"
                               VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding AvailablePeriods}"
                              SelectedItem="{Binding SelectedPeriod, Mode=TwoWay}"
                              Width="150"
                              Foreground="White"
                              FontWeight="SemiBold"
                              HorizontalContentAlignment="Center"
                              VerticalContentAlignment="Center"/>
                </StackPanel>
            </StackPanel>

            <!-- Карточки -->
            <WrapPanel>
                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="Всего заявок" Foreground="LightGray"/>
                        <TextBlock Text="{Binding TotalTickets}" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    </StackPanel>
                </Border>

                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="Активные" Foreground="LightGray"/>
                        <TextBlock Text="{Binding ActiveTickets}" FontSize="24" FontWeight="Bold" 
                               Foreground="{Binding ActiveTickets, Converter={StaticResource StatusToColorConverter}}"/>
                    </StackPanel>
                </Border>

                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="В работе" Foreground="LightGray"/>
                        <TextBlock Text="{Binding InProgressTickets}" FontSize="24" FontWeight="Bold" 
                                   Foreground="{Binding ActiveTickets, Converter={StaticResource StatusToColorConverter}}"/>
                    </StackPanel>
                </Border>

                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="Закрытые" Foreground="LightGray"/>
                        <TextBlock Text="{Binding ClosedTickets}" FontSize="24" FontWeight="Bold" 
                                   Foreground="{Binding ActiveTickets, Converter={StaticResource StatusToColorConverter}}"/>
                    </StackPanel>
                </Border>

                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="Среднее время решения (ч)" Foreground="LightGray"/>
                        <TextBlock Text="{Binding AvgResolutionTime}" FontSize="24" FontWeight="Bold" Foreground="LightBlue"/>
                    </StackPanel>
                </Border>

                <Border Background="#333" CornerRadius="8" Padding="15" Margin="0,0,10,10" Width="200">
                    <StackPanel>
                        <TextBlock Text="SLA (%)" Foreground="LightGray"/>
                        <TextBlock Text="{Binding SlaSuccessRate}" FontSize="24" FontWeight="Bold" Foreground="Gold"/>
                    </StackPanel>
                </Border>
            </WrapPanel>

            <!-- Графики -->
            <TextBlock Text="Распределение по приоритетам" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:PieChart Series="{Binding PrioritySeries}" Height="200"/>

            <TextBlock Text="Распределение по статусам" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding StatusSeries}" 
                                XAxes="{Binding StatusXAxes}" 
                                YAxes="{Binding StatusYAxes}" Height="200"/>

            <TextBlock Text="Динамика заявок" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding TimelineSeries}" 
                                XAxes="{Binding TimelineXAxes}" 
                                YAxes="{Binding TimelineYAxes}" Height="200"/>

            <TextBlock Text="Время отклика" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding ResponseTimeSeries}" 
                                XAxes="{Binding ResponseTimeXAxes}" 
                                YAxes="{Binding ResponseTimeYAxes}" Height="200"/>

            <TextBlock Text="SLA" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:PieChart Series="{Binding SlaSeries}" Height="200"/>

            <TextBlock Text="ТОП очереди" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding QueueSeries}" 
                                XAxes="{Binding QueueXAxes}" 
                                YAxes="{Binding QueueYAxes}" Height="200"/>

            <TextBlock Text="Перераспределения и возвраты" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding ReassignSeries}" 
                                XAxes="{Binding ReassignXAxes}" 
                                YAxes="{Binding ReassignYAxes}" Height="200"/>

            <TextBlock Text="Комментарии" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding CommentsSeries}" 
                                XAxes="{Binding CommentsXAxes}" 
                                YAxes="{Binding CommentsYAxes}" Height="200"/>

            <TextBlock Text="Воронка обработки заявок" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,20,0,10"/>
            <lvc:CartesianChart Series="{Binding FunnelSeries}" 
                                XAxes="{Binding FunnelXAxes}" 
                                YAxes="{Binding FunnelYAxes}" Height="200"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>