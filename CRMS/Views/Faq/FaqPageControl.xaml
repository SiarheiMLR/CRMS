<UserControl x:Class="CRMS.Views.Faq.FaqPageControl"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:metro="http://metro.mahapps.com/winfx/xaml/controls"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:md="clr-namespace:Markdig.Wpf;assembly=Markdig.Wpf"
      xmlns:local="clr-namespace:CRMS.Views.Faq"
      xmlns:vm="clr-namespace:CRMS.ViewModels.Faq"
      xmlns:domain="clr-namespace:CRMS.Domain.Entities;assembly=CRMS.Domain"
      xmlns:mdxaml="clr-namespace:MdXaml;assembly=MdXaml"
      mc:Ignorable="d"
      Background="Transparent"
      Height="Auto" Width="Auto">

    <Border CornerRadius="8"
        BorderThickness="1"
        BorderBrush="{DynamicResource MaterialDesignDivider}"
        Background="Transparent"
        Padding="5">
        <Grid Margin="10">
            <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>        

            <!-- 🔍 Search Bar -->
            <DockPanel Margin="0,0,0,10" HorizontalAlignment="Right">
            <TextBox Width="300" Height="Auto"
                     materialDesign:HintAssist.Hint="Поиск по вопросам ..."
                     Foreground="WhiteSmoke"
                     FontWeight="Bold"
                     FontSize="12"
                     FontStyle="Italic"
                     Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:TextFieldAssist.DecorationVisibility="Visible"
                     VerticalAlignment="Center"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Padding="10"/>
            <Button Command="{Binding SearchCommand}"
                    Margin="10,0,0,0"
                    VerticalAlignment="Center" HorizontalAlignment="Right"
                    Style="{StaticResource MaterialDesignFloatingActionMiniButton}"
                    Background="{DynamicResource PrimaryHueMidBrush}"
                    Foreground="White">
                <materialDesign:PackIcon Kind="Magnify" />
            </Button>
        </DockPanel>

            <!-- 📂 Accordion по категориям -->
            <ScrollViewer Grid.Row="1" Padding="5,5,0,5">
                <ItemsControl ItemsSource="{Binding Categories}" Foreground="SkyBlue" FontWeight="SemiBold" FontStyle="Normal">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type domain:FaqCategory}">
                            <!-- Border вокруг каждой категории -->
                            <Border CornerRadius="10"
                                    BorderThickness="1"
                                    BorderBrush="SkyBlue"
                                    Background="Transparent"
                                    Padding="5"
                                    Margin="0,0,0,12">
                                <Expander Header="{Binding Title}" 
                                          IsExpanded="False"
                                          Background="Transparent"
                                          BorderThickness="1"
                                          FontWeight="SemiBold"
                                          FontSize="10"
                                          Foreground="LightSkyBlue"
                                          Padding="1">
                                    <ItemsControl ItemsSource="{Binding Items}" Margin="0,5,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="{x:Type domain:FaqItem}">
                                                <Border CornerRadius="8"
                                                        BorderThickness="1"
                                                        BorderBrush="DarkSeaGreen"
                                                        Background="Transparent"
                                                        Padding="5"
                                                        Margin="0,0,0,12"
                                                        Cursor="Hand"
                                                        MouseLeftButtonUp="FaqItem_Clicked"
                                                        Tag="{Binding}">
                                                    <StackPanel>
                                                        <Expander Header="{Binding Question}"
                                                                  IsExpanded="False"
                                                                  Background="Transparent"
                                                                  BorderThickness="1"
                                                                  Margin="0,0,0,10"
                                                                  FontWeight="SemiBold"
                                                                  FontSize="10"
                                                                  Foreground="White"
                                                                  Padding="1">
                                                            <!-- Используем MdXaml для отображения Markdown -->
                                                            <mdxaml:MarkdownScrollViewer 
                                                                    Markdown="{Binding AnswerMarkdown}"
                                                                    Foreground="White"
                                                                    FontSize="8"
                                                                    Padding="1"
                                                                    VerticalScrollBarVisibility="Auto"
                                                                    HorizontalScrollBarVisibility="Disabled"
                                                                    MaxHeight="300"/>
                                                        </Expander>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Expander>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Snackbar -->
            <materialDesign:Snackbar 
            x:Name="FaqSnackbar" 
            Grid.Row="1" 
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom"
            MessageQueue="{Binding SnackbarMessageQueue}" />
    </Grid>
    </Border>
</UserControl>
